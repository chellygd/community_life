<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>登录页</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
<meta content="yes" name="apple-mobile-web-app-capable">
<meta content="black" name="apple-mobile-web-app-status-bar-style">
<meta content="telephone=no" name="format-detection">
<link rel="stylesheet" href="./system/phoneAdminLoginStyle/css/weui.css">
<link rel="stylesheet" href="./system/phoneAdminLoginStyle/css/jquery-weui.css">
<link rel="stylesheet" href="./system/phoneAdminLoginStyle/css/style.css">
<link rel="stylesheet" href="./system/phoneAdminLoginStyle/css/all.css">
<!-- <link rel="stylesheet" href="css/index.css">	 -->
<style>

.yzm a {
    display: inline-block;
    color: #2c3740;
    border-left: 1px solid #7796ab;
    padding-left: 4%;
    float: right;
}
.main1_c select {
    width: 100%;
}
.main1_t {
    font-size: 1.1em;
    font-weight: bold;
    color: #2c3740;
    margin: 0.8em 0 1em 0;
    padding-left: 15px;
    border-bottom: 1px solid #d5d7d9;
    padding-bottom: 0.2em;
}
.arr {
    text-align: center;
    position: fixed;
    top: 36px;
    z-index: 111;
    left: 50%;
    margin-left: -11px;
}
.main1_c {
    width: 92%;
    margin: auto;
}


.head{
	
	height: 45px;
	line-height: 45px;
	box-shadow: 0 1px 1px 1px #e4e4e4;
	background:#2c3740;
	position: fixed;
	left: 0;
	top: 0;
	z-index: 100;
	width: 100%;
	color: #fff;
	padding-left: 4%;
}
.head .return{
	position: absolute;
	left: 0;
	top: 0;
	width: 45px;
	height: 45px;
}
.head .return:after{
	content: " ";
    display: inline-block;
    height: 13px;
    width: 13px;
    border-width: 2px 2px 0 0;
    border-color: #C8C8CD;
    border-style: solid;
    -webkit-transform: matrix(0.71, 0.71, -0.71, 0.71, 0, 0);
    transform: matrix(0.71, 0.71, -0.71, 0.71, 0, 0);
    position: absolute;
    transform:rotate(225deg);
    left: 16px;
    top: 14px;
}
.head .operation{
	position: absolute;
	right: 0;
	top: 0;
	width: 60px;
	height: 45px;
	color:#fff;
}
.head .operation2{
	right: 10%;
}
.weui-cells{
	border: 1px solid #7796ab;
}	
.weui-cells_checkbox .weui-check:checked + .weui-icon-checked:before{
	color: #4e9bdd;
}

.weui-cells:before{
	border-top: 0;
}
.weui-cells:after{
	border-bottom: 0;
}
.weui-btn_plain-primary {
    color: #fff;
    border: 1px solid #4e9bdd;
    border-radius: 30px;
    background: #4e9bdd;
    width: 80%;
    height: 2.4em;
    line-height: 2.3em;
}
.qx .weui-btn_plain-primary{
	color: #2c3740;
	background: #d5d7d9;
	border: 1px solid #d5d7d9;
}
.weui-textarea{
	font-size: 0.9em;
}
.weui-agree__text {
    color: #2c3740;
    font-size: 1.1em;
}


.weui-agree__checkbox{
	border: 1px solid #7796ab;
}
.weui-agree__checkbox:checked:before{
	color: #777e84;
}
.dq{
	margin-top: 1.4em;
}
.dq .weui-input{
	width: 30%;
	margin-right: 2.5%;
	border: 1px solid #7796ab;
	height: 2em;
	text-align: center;
}
.dq .mar0{
	margin-right: 0;
}
.yzm a{
	width: 25%;
}
.xinn input{
	width: 92%;
	background: url(./system/phoneAdminLoginStyle/imgs/tu28.png)no-repeat 0 0;
	background-size: 5%;
	padding-left: 28px;
}
.yzm .weui-input{
	width: 53%;
	background: url(./system/phoneAdminLoginStyle/imgs/tu29.png)no-repeat 0 0;
	background-size: 10%;
	padding-left: 28px;
}
.weui-btn_primary{
	background: #4e9bdd;
	border-radius: 0;
	margin-top: 1em;
}
.flex{
	display:flex;
	justify-content: space-between;
}
.flex .weui-select{
	font-size:0.9em;
	padding-left:10px;
}
.xinn2{
	border:0;
	margin-top:0.6em;
}
.xinn2 .weui-cell{
	padding-left:0;
	padding-top:0;
}
#remember{
	margin-right:8px;
}
.xinn2 span{
	font-size:0.9em;
}

</style>
</head>
<body>
<div class="box1">
	<div class="head position_r">山东省学校创客空间服务平台 <a href="javascript:;" class="operation operation2"><img src="./system/phoneAdminLoginStyle/imgs/tu1.png" alt="" width="28%"></a><a href="javascript:;" class="operation"><img src="./system/phoneAdminLoginStyle/imgs/tu2.png" alt="" width="28%"></a>
		
	</div>
	<div class="head2" style="height: 45px;"></div>
	<div class="arr"><img src="./system/phoneAdminLoginStyle/imgs/tu3.png" alt=""></div>

	<div class="main1_t">请登录</div>
	<div class="main1_c">
		
		<div class="weui-cells">
		 	<div class="weui-cell weui-cell_select">
		        <div class="weui-cell__bd">
		          <select class="weui-select" id="chooseManager">
		            <option value="province">省级管理员</option>
		            <option value="city">地市管理员</option>
		            <option value="county">区县管理员</option>
		            <option value="school" selected>学校管理员</option>
		          </select>
		        </div>
		    </div>
		</div>
		<!-- <div class="weui-cells"> -->
			<!-- <div class="dq">
				 <input class="weui-input" type="text" id="city-picker2" placeholder="请选择省份" value="" readonly="" data-code="110000" data-codes="110000,110000">
				 <input class="weui-input" type="text" id="city-picker3" placeholder="请选择地市" value="" readonly="" data-code="110000" data-codes="110000,110000">
				 <input class="weui-input mar0" type="text" id="city-picker4" placeholder="请选择区县" value="" readonly="" data-code="110000" data-codes="110000,110000">
			</div> -->
		<!-- </div> -->
		<div class="flex">
		<div class="weui-cells" style="display:inline-block;width:32%;">
		 	<div class="weui-cell weui-cell_select">
		        <div class="weui-cell__bd">
		          <!-- 省级 -->
		          <select class="weui-select" name="quiz1" id="select_province">
		            
		          </select>
		        </div>
		    </div>
		</div>
		<div class="weui-cells" style="display:inline-block;width:32%;">
		 	<div class="weui-cell weui-cell_select">
		        <div class="weui-cell__bd">
		          <!-- 市级 -->
		          <select class="weui-select" name="quiz2" id="select_city">
		            
		          </select>
		        </div>
		    </div>
		</div>
		<div class="weui-cells" style="display:inline-block;width:32%;">
		 	<div class="weui-cell weui-cell_select">
		        <div class="weui-cell__bd" >
		          <!-- 区县级 -->
		          <select class="weui-select" name="quiz3" id="select_county" >
		            
		          </select>
		        </div>
		    </div>
		</div>
		</div>
		<div class="weui-cells">
		 	<div class="weui-cell weui-cell_select">
		        <div class="weui-cell__bd">
		        <!-- 学校 -->
		          <select class="weui-select" name="quiz3" id="select_school">
		            
		          </select>
		        </div>
		    </div>
		</div>
		
		<div class="weui-cells xinn">
		  <div class="weui-cell">
		    <div class="weui-cell__bd">
		      <input class="weui-input" type="password" id="pwd" name="pwd" placeholder="请输入密码">
		    </div>
		  </div>
		</div>

		<div class="weui-cells yzm">
		  <div class="weui-cell">
		    <div class="weui-cell__bd clearfix">
		      <input type="hidden" id="vkHidden" name="vk" />
		      <input class="weui-input" id="yzm" name="yzm" placeholder="请输入验证码" type="text" placeholder="请输入验证码">
		      <a href="javascript:;"><img id="login_change_vercode" onclick="setVerCode()" alt="" width="90%"></a>
		    </div>
		  </div>
		</div>
		<div class="weui-cells xinn2">
		  <div class="weui-cell">
		  <div class="weui-cell__hd">
				<input type="checkbox" name="remember" id="remember" title="记住密码" checked>
		    </div>
	      	<span>记住密码</span>
		    
		  </div>
		</div>
		<a href="javascript:;" class="weui-btn weui-btn_primary" onclick="submitCode()">登录</a>
	</div>
</div>

<script type="text/javascript" src="./system/phoneAdminLoginStyle/js/jquery-1.12.4.js"></script>
<script src="./system/phoneAdminLoginStyle/js/jquery.min.js"></script>
<script src="./system/phoneAdminLoginStyle/js/jquery-weui.min.js"></script>	
<script src="./system/phoneAdminLoginStyle/js/city-picker.min.js"></script>
<script type="text/javascript" src="./plug-in/jquery/jquery.cookie.js"></script>
<script>
var provinceId = "";
var cityId = "";
var countyId = "";
var schoolId = "";
var currentRole = "";
$(function(){
	//验证码初始化
	setVerCode();
	
  	if($.cookie("remeberuserrole")){
  		currentRole = $.cookie("remeberuserrole");
  		var username = $.cookie("remeberusername");
  		var pwd = $.cookie("remeberpassword");
  		if($.cookie("remeberremember")){
  		  	$('#remember').attr("checked","checked");
  	    }
  		$("#pwd").val(pwd);
  	  	loadCookieData(username);
    }else{
    	currentRole = "school";
	  	getProvinceByParentId();
    }
	/* currentRole = "school";
  	getProvinceByParentId(); */
});

 // 更换验证码
function setVerCode(){
	//var $ = layui.$;
	var vk = "ckkj"+guid();
	$("#vkHidden").val(vk);
	$("#login_change_vercode").attr("src", "verification/get?vk="+vk+"&"+Math.random());
}
 
function loadCookieData(username){
	
	var form = layui.form;
	if(currentRole === "province"){
		provinceId = username.substring(0,2);
		cityId = "";
		countyId = "";
		schoolId = "";
		$("#chooseManager").val("province");
		
	    $("#select_city").html("<option value=\"\">请选择市</option>");//<option value=\"\">请选择市</option>
	    $("#select_city").attr("disabled","disabled");
	    
	    $("#select_county").html("<option value=\"\">请选择区县</option>");//<option value=\"\">请选择区县</option>
	    $("#select_county").attr("disabled","disabled");
	    
		$("#select_school").html("<option value=\"\">请选择学校</option>");//<option value=\"\">请选择学校</option>
		$("#select_school").attr("disabled","disabled");
		
	    getProvinceByParentId1(provinceId);
    }
	if(currentRole === "city"){
		provinceId = username.substring(0,2);
		cityId = username.substring(0,4);
		countyId = "";
		schoolId = "";
		$("#chooseManager").val("city");
		
		//$("#select_city").html("<option value=\"\">请选择市</option>");
	    //$("#select_city").attr("disabled",false);
	    $("#select_county").html("<option value=\"\">请选择区县</option>");//<option value=\"\">请选择区县</option>
	    $("#select_county").attr("disabled","disabled");
	    
		$("#select_school").html("<option value=\"\">请选择学校</option>");//<option value=\"\">请选择学校</option>
		$("#select_school").attr("disabled","disabled");
		
		getProvinceByParentId1(provinceId);
		getCityByProvinceId1(provinceId,cityId);
    }
	if(currentRole === "county"){
		provinceId = username.substring(0,2);
		cityId = username.substring(0,4);
		countyId = username.substring(0,6);
		schoolId = "";
		$("#chooseManager").val("county");
		
		//$("#select_county").html("<option value=\"\">请选择区县</option>");
	    //$("#select_county").attr("disabled",false);
	    
		$("#select_school").html("<option value=\"\">请选择学校</option>");//<option value=\"\">请选择学校</option>
		$("#select_school").attr("disabled","disabled");
		
		getProvinceByParentId1(provinceId);
		getCityByProvinceId1(provinceId,cityId);
		getCountyByCityId1(cityId,countyId);
	}
	if(currentRole === "school"){
		provinceId = username.substring(0,2);
		cityId = username.substring(0,4);
		countyId = username.substring(0,6);
		schoolId = username.substring(0,9);
		$("#chooseManager").val("school");
		
		//$("#select_school").attr("disabled",false);
		
		getProvinceByParentId1(provinceId);
		getCityByProvinceId1(provinceId,cityId);
		getCountyByCityId1(cityId,countyId);
		getSchoolByCountyId1(countyId,schoolId);
	} 
}
 
function submitCode(){
	var admin = layui.admin;
	var setter = layui.setter;
	var router = layui.router();
	var search = router.search;
	
	var pwd = $("#pwd").val();
	var vercode = $("#yzm").val();
	var vk = $("#vkHidden").val();
	var remember = "off";
	if($('#remember').is(':checked')) {
	    // do something
		remember = "on";
	}
	var username = "";
	if (currentRole === "province") {
	    if (provinceId == "" || provinceId == null || provinceId == undefined) {
	        layer.msg("请选择省");
	        return false;
	    }
	    username = provinceId;
	}
	if (currentRole === "city") {
	    if (cityId == "" || cityId == null || cityId == undefined) {
	        layer.msg("请选择市");
	        return false;
	    }
	    username = cityId;
	}
	if (currentRole === "county") {
	    if (countyId == "" || countyId == null || countyId == undefined) {
	        layer.msg("请选择区县");
	        return false;
	    }
	    username = countyId;
	}
	if (currentRole === "school") {
	    if (schoolId == "" || schoolId == null || schoolId == undefined) {
	        layer.msg("请选择学校");
	        return false;
	    }
	    username = schoolId;
	}
	
	admin.req({
		url: 'login/login/newLogin' //实际使用请改成服务端真实接口
		,data: {username:username,password:pwd,vercode:vercode,vk:vk}
		,done: function(res){
			if(res.success){
				if(remember=="on"){
				  //设置cookie有效期为7天，默认不设置的话，关闭浏览器就会失效
				  $.cookie("remeberuserrole", currentRole, { expires: 7 });
				  $.cookie("remeberusername", username, { expires: 7 });
				  $.cookie("remeberpassword", pwd, { expires: 7 });
				  $.cookie("remeberremember", remember, { expires: 7 });
				}
				//console.dir($.cookie("remeberuserrole")+"===="+$.cookie("remeberusername")+"===="+$.cookie("remeberpassword")+"===="+$.cookie("remeberremember"));
				//请求成功后，写入 access_token
				layui.data(setter.tableName, {
				  key: setter.request.tokenName
				  ,value: res.data.access_token
				});
				
				//登入成功的提示与跳转
				layer.msg('登入成功', {
				  offset: '15px'
				  ,icon: 1
				  ,time: 1000
				}, function(){
				  location.hash = search.redirect ? decodeURIComponent(search.redirect) : '/';
				});
			}else{
				layer.msg(res.msg);
			}
		}
	});
}

$('#chooseManager').change(function() {
	var roleName = $("#chooseManager").val();
	if(roleName === "province"){
		currentRole = "province";
		cityId = "";
		countyId = "";
		schoolId = "";
		
	    $("#select_city").html("<option value=\"\">请选择市</option>");
	    $("#select_city").attr("disabled","disabled");
	    
	    $("#select_county").html("<option value=\"\">请选择区县</option>");
	    $("#select_county").attr("disabled","disabled");
	    
		$("#select_school").html("<option value=\"\">请选择学校</option>");
		$("#select_school").attr("disabled","disabled");
		
    }
	if(roleName === "city"){
		currentRole = "city";
		countyId = "";
		schoolId = "";
		
		//$("#select_city").html("<option value=\"\">请选择市</option>");
	    $("#select_city").attr("disabled",false);
	    $("#select_county").html("<option value=\"\">请选择区县</option>");
	    $("#select_county").attr("disabled","disabled");
	    
		$("#select_school").html("<option value=\"\">请选择学校</option>");
		$("#select_school").attr("disabled","disabled");
		if(provinceId != null && provinceId != "" && provinceId != undefined && (cityId == "" || cityId == null || cityId == undefined)){
			getCityByProvinceId();
		}
		
    }
	if(roleName === "county"){
		currentRole = "county";
		schoolId = "";
		
		//$("#select_county").html("<option value=\"\">请选择区县</option>");
	    $("#select_county").attr("disabled",false);
	    
		$("#select_school").html("<option value=\"\">请选择学校</option>");
		$("#select_school").attr("disabled","disabled");
		
		if($("#select_city").attr("disabled")){
			$("#select_city").attr("disabled",false);
			if(provinceId != null && provinceId != "" && provinceId != undefined && (cityId == "" || cityId == null || cityId == undefined)){
				getCityByProvinceId();
			}
		}else{
			if(cityId != null && cityId != "" && cityId != undefined && (countyId == "" || countyId == null || countyId == undefined)){
				getCountyByCityId();
			}
		}
	}
	if(roleName === "school"){
		currentRole = "school";
		
		$("#select_school").attr("disabled",false);
		
		if($("#select_city").attr("disabled")){
			$("#select_city").attr("disabled",false);
			$("#select_county").attr("disabled",false);
			if(provinceId != null && provinceId != "" && provinceId != undefined && (cityId == "" || cityId == null || cityId == undefined)){
				getCityByProvinceId();
			}
		}else{
			if($("#select_county").attr("disabled")){
				$("#select_county").attr("disabled",false);
				if(cityId != null && cityId != "" && cityId != undefined && (countyId == "" || countyId == null || countyId == undefined)){
					getCountyByCityId();
				}
			}else{
				if(countyId != null && countyId != "" && countyId != undefined && (schoolId == "" || schoolId == null || schoolId == undefined)){
					getSchoolByCountyId();
				}
			}
		}
	} 
});

$('#select_province').change(function() {
	provinceId = $("#select_province").val();
	cityId = "";
	countyId = "";
	schoolId = "";
	if(null == provinceId || "" == provinceId || undefined == provinceId){
		$("#select_city").html("<option value=\"\">请选择市</option>");
		$("#select_county").html("<option value=\"\">请选择区县</option>");	
		$("#select_school").html("<option value=\"\">请选择学校</option>");	
	}else{
		$("#select_county").html("<option value=\"\">请选择区县</option>");	
		$("#select_school").html("<option value=\"\">请选择学校</option>");	
		getCityByProvinceId();
	}
	  
});
$('#select_city').change(function() {
	cityId = $("#select_city").val();
	countyId = "";
	schoolId = "";
	if(null == cityId || "" == cityId || undefined == cityId){
		$("#select_county").html("<option value=\"\">请选择区县</option>");	
		$("#select_school").html("<option value=\"\">请选择学校</option>");
	}else{
		$("#select_school").html("<option value=\"\">请选择学校</option>");
		getCountyByCityId();
	}
});  
$('#select_county').change(function() {
	countyId = $("#select_county").val();
	schoolId = "";
	if(null == countyId || "" == countyId || undefined == countyId){	
		$("#select_school").html("<option value=\"\">请选择学校</option>");
	}else{	
		getSchoolByCountyId();
	}
});
$('#select_school').change(function() {
	schoolId = $("#select_school").val();
});


function getProvinceByParentId(){
    var admin = layui.admin;
	admin.req({
      url: 'wkrj/orgSchools/getDeptByParentDeptId_forAdminLogin' //实际使用请改成服务端真实接口
      ,data: {parentDeptId:""}
      ,done: function(d){
    	if(null != d.data){
    		var html = "<option value=\"\">请选择省</option>";
    		for(var i=0;i<d.data.length;i++){ 
    			html += "<option value=\""+d.data[i].dept_id+"\">"+d.data[i].dept_name+"</option>";
			}
	        $("#select_province").html(html);
	        $("#select_city").html("<option value=\"\">请选择市</option>");
		    $("#select_county").html("<option value=\"\">请选择区县</option>");
			$("#select_school").html("<option value=\"\">请选择学校</option>");
    	}
      }
    });
}

function getProvinceByParentId1(province_id){
	var admin = layui.admin;
	admin.req({
      url: 'wkrj/orgSchools/getDeptByParentDeptId_forAdminLogin' //实际使用请改成服务端真实接口
      ,data: {parentDeptId:""}
      ,done: function(d){
    	if(null != d.data){
    		var html = "<option value=\"\">请选择省</option>";
    		for(var i=0;i<d.data.length;i++){ 
    			html += "<option value=\""+d.data[i].dept_id+"\">"+d.data[i].dept_name+"</option>";
			}
	        $("#select_province").html(html);
	        $("#select_province").val(province_id);
    	}
      }
    });
}

function getCityByProvinceId(){
	var admin = layui.admin;
	admin.req({
    url: 'wkrj/orgSchools/getDeptByParentDeptId_forAdminLogin' //实际使用请改成服务端真实接口
    ,data: {parentDeptId:provinceId}
    ,done: function(d){
		if(null != d.data){
			var html = "<option value=\"\">请选择市</option>";
	  		for(var i=0;i<d.data.length;i++){ 
	  			html += "<option value=\""+d.data[i].dept_id+"\">"+d.data[i].dept_name+"</option>";
			}
	        $("#select_city").html(html);
  		}
    }
  });
}

function getCityByProvinceId1(province_id,city_id){
	var admin = layui.admin;
	admin.req({
    url: 'wkrj/orgSchools/getDeptByParentDeptId_forAdminLogin' //实际使用请改成服务端真实接口
    ,data: {parentDeptId:province_id}
    ,done: function(d){
		if(null != d.data){
			var html = "<option value=\"\">请选择市</option>";
  			for(var i=0;i<d.data.length;i++){ 
  				html += "<option value=\""+d.data[i].dept_id+"\">"+d.data[i].dept_name+"</option>";
			}
	        $("#select_city").html(html);
	        $("#select_city").val(city_id);
  		}
    }
  });
}

function getCountyByCityId(){
	var admin = layui.admin;
	admin.req({
    url: 'wkrj/orgSchools/getDeptByParentDeptId_forAdminLogin' //实际使用请改成服务端真实接口
    ,data: {parentDeptId:cityId}
    ,done: function(d){
		if(null != d.data){
			var html = "<option value=\"\">请选择区县</option>";
	  		for(var i=0;i<d.data.length;i++){ 
	  			html += "<option value=\""+d.data[i].dept_id+"\">"+d.data[i].dept_name+"</option>";
			}
	        $("#select_county").html(html);
  		}
    }
  });
}

function getCountyByCityId1(city_id,county_id){
	var admin = layui.admin;
	admin.req({
    url: 'wkrj/orgSchools/getDeptByParentDeptId_forAdminLogin' //实际使用请改成服务端真实接口
    ,data: {parentDeptId:city_id}
    ,done: function(d){
		if(null != d.data){
			var html = "<option value=\"\">请选择区县</option>";
	  		for(var i=0;i<d.data.length;i++){ 
	  			html += "<option value=\""+d.data[i].dept_id+"\">"+d.data[i].dept_name+"</option>";
			}
	        $("#select_county").html(html);
	        $("#select_county").val(county_id);
  		}
    }
  });
}

function getSchoolByCountyId(){
	var admin = layui.admin;
	admin.req({
    url: 'wkrj/orgSchools/getDeptByParentDeptId_forAdminLogin' //实际使用请改成服务端真实接口
    ,data: {parentDeptId:countyId}
    ,done: function(d){
		if(null != d.data){
			var html = "<option value=\"\">请选择学校</option>";
	  		for(var i=0;i<d.data.length;i++){ 
	  			html += "<option value=\""+d.data[i].dept_id+"\">"+d.data[i].dept_name+"</option>";
			}
	        $("#select_school").html(html);
  		}
    }
  });
}

function getSchoolByCountyId1(county_id,school_id){
	var admin = layui.admin;
	admin.req({
    url: 'wkrj/orgSchools/getDeptByParentDeptId_forAdminLogin' //实际使用请改成服务端真实接口
    ,data: {parentDeptId:county_id}
    ,done: function(d){
		if(null != d.data){
			var html = "<option value=\"\">请选择学校</option>";
	  		for(var i=0;i<d.data.length;i++){ 
	  			html += "<option value=\""+d.data[i].dept_id+"\">"+d.data[i].dept_name+"</option>";
			}
	        $("#select_school").html(html);
	        $("#select_school").val(school_id);
  		}
    }
  });
}
function S4() {
    return (((1+Math.random())*0x10000)|0).toString(16).substring(1);
}
function guid() {
    return (S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4());
}
</script>
</body>
</html>	
